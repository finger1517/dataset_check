# è§†é¢‘æ•°æ®é›†å¤„ç†æ•ˆèƒ½æ¯”è¾ƒå·¥å…·

è¿™ä¸ªå·¥å…·åŒ…æä¾›äº†ä½¿ç”¨Rayã€HuggingFaceå’ŒPyTorchä¸‰ç§ä¸åŒæ•°æ®é›†æ¡†æ¶å¤„ç†è§†é¢‘æ•°æ®çš„å®ç°ï¼Œå¹¶èƒ½å¤Ÿæ¯”è¾ƒå®ƒä»¬çš„æ€§èƒ½è¡¨ç°ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¬ **è§†é¢‘å¸§æå–**: ä»MP4è§†é¢‘ä¸­å‡åŒ€æå–16å¸§
- ğŸ–¼ï¸ **å›¾åƒé¢„å¤„ç†**: å°†å¸§è°ƒæ•´ä¸º224x224å°ºå¯¸å¹¶è¿›è¡Œæ ‡å‡†åŒ–
- âš¡ **å¤šæ¡†æ¶æ”¯æŒ**: Ray Dataã€HuggingFace Datasetsã€PyTorch Dataset
- ğŸ“Š **æ€§èƒ½æ¯”è¾ƒ**: è¯¦ç»†çš„å¤„ç†é€Ÿåº¦å’Œå†…å­˜ä½¿ç”¨æƒ…å†µåˆ†æ
- ğŸ”§ **å¤šç§ä¼˜åŒ–**: é¢„åŠ è½½ã€å¤šè¿›ç¨‹ã€ç¼“å­˜ç­‰ä¼˜åŒ–ç­–ç•¥

## æ–‡ä»¶ç»“æ„

```
dataset_maker/
â”œâ”€â”€ video_dataset_comparison.py    # ä¸»è¦çš„æ¯”è¾ƒè„šæœ¬
â”œâ”€â”€ ray_data.py                   # Rayæ•°æ®é›†ä¸“é—¨å®ç°
â”œâ”€â”€ huggingface_data.py          # HuggingFaceæ•°æ®é›†ä¸“é—¨å®ç°
â”œâ”€â”€ pytorch_data.py              # PyTorchæ•°æ®é›†ä¸“é—¨å®ç°
â”œâ”€â”€ requirements.txt             # ä¾èµ–åŒ…åˆ—è¡¨
â””â”€â”€ README.md                    # è¯´æ˜æ–‡æ¡£
```

## å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

ä¸»è¦ä¾èµ–åŒ…ï¼š
- `torch>=1.12.0` - PyTorchæ·±åº¦å­¦ä¹ æ¡†æ¶
- `torchvision>=0.13.0` - PyTorchè§†è§‰åº“
- `ray[data]>=2.0.0` - Rayåˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶
- `datasets>=2.0.0` - HuggingFaceæ•°æ®é›†åº“
- `opencv-python>=4.6.0` - OpenCVè§†é¢‘å¤„ç†
- `numpy>=1.21.0` - æ•°å€¼è®¡ç®—
- `pandas>=1.4.0` - æ•°æ®åˆ†æ
- `psutil>=5.9.0` - ç³»ç»Ÿç›‘æ§

## ä½¿ç”¨æ–¹æ³•

### 1. è¿è¡Œå®Œæ•´æ¯”è¾ƒæµ‹è¯•

```bash
cd dataset_maker
python video_dataset_comparison.py
```

è¿™å°†ï¼š
- è‡ªåŠ¨æœç´¢ `../video_data` ç›®å½•ä¸­çš„æ‰€æœ‰MP4æ–‡ä»¶
- ä½¿ç”¨ä¸‰ç§æ•°æ®é›†æ¡†æ¶åˆ†åˆ«å¤„ç†è§†é¢‘æ•°æ®
- æµ‹é‡å¤„ç†æ—¶é—´ã€å†…å­˜ä½¿ç”¨ç­‰æ€§èƒ½æŒ‡æ ‡
- ç”Ÿæˆè¯¦ç»†çš„æ¯”è¾ƒæŠ¥å‘Š
- å°†ç»“æœä¿å­˜åˆ°CSVæ–‡ä»¶

### 2. å•ç‹¬æµ‹è¯•å„ä¸ªæ¡†æ¶

#### Rayæ•°æ®é›†æµ‹è¯•
```bash
python ray_data.py
```

#### HuggingFaceæ•°æ®é›†æµ‹è¯•
```bash
python huggingface_data.py
```

#### PyTorchæ•°æ®é›†æµ‹è¯•
```bash
python pytorch_data.py
```

## æ•°æ®é›†å®ç°è¯¦æƒ…

### Rayæ•°æ®é›† (`ray_data.py`)
- **ç‰¹ç‚¹**: åˆ†å¸ƒå¼å¤„ç†ï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ®
- **ä¼˜åŠ¿**: è‡ªåŠ¨å¹¶è¡ŒåŒ–ï¼Œå†…å­˜é«˜æ•ˆ
- **é…ç½®**: å¯è°ƒæ•´æ‰¹å¤„ç†å¤§å°å’Œå·¥ä½œè¿›ç¨‹æ•°

```python
from ray_data import RayVideoDataset

dataset = RayVideoDataset(video_paths)
ray_dataset = dataset.create_dataset(batch_size=4)
```

### HuggingFaceæ•°æ®é›† (`huggingface_data.py`)
- **ç‰¹ç‚¹**: å¼ºå¤§çš„ç¼“å­˜å’Œåºåˆ—åŒ–åŠŸèƒ½
- **ä¼˜åŠ¿**: æ•°æ®æŒä¹…åŒ–ï¼Œå¤šè¿›ç¨‹å¤„ç†
- **é…ç½®**: æ”¯æŒç¼“å­˜åˆ°ç£ç›˜ï¼Œå¯é…ç½®å¤„ç†è¿›ç¨‹æ•°

```python
from huggingface_data import HuggingFaceVideoDataset

dataset = HuggingFaceVideoDataset(video_paths)
hf_dataset = dataset.create_dataset(num_proc=4)
```

### PyTorchæ•°æ®é›† (`pytorch_data.py`)
- **ç‰¹ç‚¹**: æ·±åº¦å­¦ä¹ ç”Ÿæ€ç³»ç»Ÿé›†æˆåº¦é«˜
- **ä¼˜åŠ¿**: å¤šç§ä¼˜åŒ–ç­–ç•¥ï¼ˆé¢„åŠ è½½ã€å¯è¿­ä»£ç­‰ï¼‰
- **é…ç½®**: æ”¯æŒå¤šå·¥ä½œè¿›ç¨‹ã€GPUåŠ é€Ÿ

```python
from pytorch_data import PyTorchVideoDataset

dataset = PyTorchVideoDataset(video_paths, preload=True)
dataloader = DataLoader(dataset, batch_size=4, num_workers=2)
```

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### Rayæ•°æ®é›†ä¼˜åŒ–
- è°ƒæ•´ `batch_size` å‚æ•°
- ä½¿ç”¨ `repartition()` ä¼˜åŒ–æ•°æ®åˆ†å¸ƒ
- é…ç½®åˆé€‚çš„CPUèµ„æºåˆ†é…

### HuggingFaceæ•°æ®é›†ä¼˜åŒ–
- å¯ç”¨ç£ç›˜ç¼“å­˜å‡å°‘é‡å¤å¤„ç†
- ä½¿ç”¨å¤šè¿›ç¨‹ (`num_proc`) åŠ é€Ÿå¤„ç†
- åˆ©ç”¨Arrowæ ¼å¼çš„é«˜æ•ˆå­˜å‚¨

### PyTorchæ•°æ®é›†ä¼˜åŒ–
- é¢„åŠ è½½æ•°æ®åˆ°å†…å­˜ (`preload=True`)
- ä½¿ç”¨å¤šå·¥ä½œè¿›ç¨‹ (`num_workers`)
- å¯ç”¨å†…å­˜å›ºå®š (`pin_memory=True`)
- é€‰æ‹©åˆé€‚çš„æ•°æ®é›†ç±»å‹ï¼ˆæ ‡å‡†vså¯è¿­ä»£ï¼‰

## æµ‹è¯•ç»“æœç¤ºä¾‹

```
ğŸ“Š è§†é¢‘æ•°æ®é›†å¤„ç†æ€§èƒ½æ¯”è¾ƒç»“æœ
================================================================================

ğŸ¯ PyTorch Dataset:
   æ€»å¤„ç†æ—¶é—´: 15.23 ç§’
   å¤„ç†æ ·æœ¬æ•°: 20
   å¤„ç†é€Ÿåº¦: 1.31 æ ·æœ¬/ç§’
   å†…å­˜ä½¿ç”¨: 245.67 MB
   å³°å€¼å†…å­˜: 512.34 MB

ğŸ¯ Ray Dataset:
   æ€»å¤„ç†æ—¶é—´: 12.45 ç§’
   å¤„ç†æ ·æœ¬æ•°: 20
   å¤„ç†é€Ÿåº¦: 1.61 æ ·æœ¬/ç§’
   å†…å­˜ä½¿ç”¨: 189.23 MB
   å³°å€¼å†…å­˜: 423.12 MB

ğŸ¯ HuggingFace Dataset:
   æ€»å¤„ç†æ—¶é—´: 18.67 ç§’
   å¤„ç†æ ·æœ¬æ•°: 20
   å¤„ç†é€Ÿåº¦: 1.07 æ ·æœ¬/ç§’
   å†…å­˜ä½¿ç”¨: 156.78 MB
   å³°å€¼å†…å­˜: 389.45 MB

ğŸ† æœ€å¿«å¤„ç†: Ray Dataset (1.61 æ ·æœ¬/ç§’)
ğŸ’¾ æœ€çœå†…å­˜: HuggingFace Dataset (156.78 MB)
```

## è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹è§†é¢‘å¤„ç†å‚æ•°

```python
# ä¿®æ”¹æå–å¸§æ•°
num_frames = 32  # é»˜è®¤16

# ä¿®æ”¹ç›®æ ‡å°ºå¯¸
target_size = (256, 256)  # é»˜è®¤(224, 224)

# ä¿®æ”¹æ‰¹å¤„ç†å¤§å°
batch_size = 8  # é»˜è®¤4
```

### ä¿®æ”¹æ•°æ®è·¯å¾„

```python
# åœ¨è„šæœ¬ä¸­ä¿®æ”¹VIDEO_DATA_PATHå˜é‡
VIDEO_DATA_PATH = "/path/to/your/video/data"
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å†…å­˜ä¸è¶³é”™è¯¯**
   - å‡å°‘æ‰¹å¤„ç†å¤§å°
   - å…³é—­é¢„åŠ è½½åŠŸèƒ½
   - å‡å°‘å·¥ä½œè¿›ç¨‹æ•°

2. **è§†é¢‘è¯»å–å¤±è´¥**
   - æ£€æŸ¥è§†é¢‘æ–‡ä»¶æ˜¯å¦æŸå
   - ç¡®è®¤OpenCVæ”¯æŒçš„è§†é¢‘æ ¼å¼
   - æ£€æŸ¥æ–‡ä»¶è·¯å¾„æƒé™

3. **Rayåˆå§‹åŒ–é”™è¯¯**
   - ç¡®ä¿Rayç‰ˆæœ¬å…¼å®¹
   - æ£€æŸ¥ç³»ç»Ÿèµ„æºæ˜¯å¦å……è¶³
   - å°è¯•é‡å¯Rayé›†ç¾¤

### æ€§èƒ½è°ƒä¼˜å»ºè®®

1. **å¯¹äºå°æ•°æ®é›†** (< 100ä¸ªè§†é¢‘)
   - ä½¿ç”¨PyTorché¢„åŠ è½½æ¨¡å¼
   - å¯ç”¨å¤šå·¥ä½œè¿›ç¨‹

2. **å¯¹äºä¸­ç­‰æ•°æ®é›†** (100-1000ä¸ªè§†é¢‘)
   - ä½¿ç”¨Rayæ•°æ®é›†
   - é€‚å½“è°ƒæ•´æ‰¹å¤„ç†å¤§å°

3. **å¯¹äºå¤§æ•°æ®é›†** (> 1000ä¸ªè§†é¢‘)
   - ä½¿ç”¨HuggingFaceç¼“å­˜åŠŸèƒ½
   - è€ƒè™‘åˆ†å¸ƒå¼å¤„ç†

## æ‰©å±•åŠŸèƒ½

### æ·»åŠ æ–°çš„æ•°æ®å˜æ¢

```python
from torchvision import transforms

custom_transform = transforms.Compose([
    transforms.ToTensor(),
    transforms.RandomHorizontalFlip(p=0.5),
    transforms.ColorJitter(brightness=0.2),
    transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])
])
```

### æ”¯æŒå…¶ä»–è§†é¢‘æ ¼å¼

```python
# åœ¨find_all_mp4_fileså‡½æ•°ä¸­æ·»åŠ å…¶ä»–æ ¼å¼
supported_formats = ['.mp4', '.avi', '.mov', '.mkv']
```

## è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤é—®é¢˜æŠ¥å‘Šå’ŒåŠŸèƒ½è¯·æ±‚ï¼å¦‚æœæ‚¨æƒ³è´¡çŒ®ä»£ç ï¼Œè¯·ï¼š

1. Forkè¿™ä¸ªé¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ‚¨çš„æ›´æ”¹
4. åˆ›å»ºPull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ã€‚è¯¦è§LICENSEæ–‡ä»¶ã€‚ 